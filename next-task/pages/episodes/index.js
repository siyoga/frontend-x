import Head from 'next/head';
import EpisodeCard from '../../components/episode-card';
import { useEffect, useState } from 'react';
import Link from 'next/link';

export default function Episodes() {
  const [page, setPage] = useState(1);
  const [info, setInfo] = useState();
  const [episodes, setEpisodes] = useState([]);
  const [searchValue, setSearchValue] = useState('');

  useEffect(() => {
    fetch(`https://rickandmortyapi.com/api/episode?page=${page}`)
      .then((response) => response.json())
      .then((data) => {
        console.log(data.results);
        setEpisodes((prev) => [...prev, ...data.results]);
        setInfo(data.info);
      });
  }, [page]);

  useEffect(() => {
    fetch(`https://rickandmortyapi.com/api/episode?name=${searchValue}`)
      .then((response) => response.json())
      .then((data) => {
        console.log(data.results);
        setEpisodes(data.results);
        setInfo(data.info);
      });
  }, [searchValue]);

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main
        style={{
          backgroundColor: 'white',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
        }}
      >
        <h1>Episodes</h1>
        <input
          value={searchValue}
          onChange={(e) => setSearchValue(e.target.value)}
        />

        <div
          style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(4, 1fr)',
            gap: '1em',
          }}
        >
          {episodes.map((episode, index) => (
            <Link href={`/episodes/${episode.id}`} key={index}>
              <EpisodeCard
                air_date={episode.air_date}
                name={episode.name}
                episode={episode.episode}
              />
            </Link>
          ))}
        </div>
        {info?.next && (
          <button onClick={() => setPage((prev) => ++prev)}>Load more</button>
        )}
      </main>
    </>
  );
}
